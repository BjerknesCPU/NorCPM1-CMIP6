      SUBROUTINE PROFILE(kpie,kpje,kpke,ptiestu,omask)
!
!**********************************************************************
!
!**** *CALC_EZ* - .
!
!     Karen Assmann          *BCCR*           02.12.05
! 
!     find lowest mass containing layer in the euphotic zone
!

      USE mo_biomod
      USE mo_carbch
      USE mo_control_bgc
      use mo_param1_bgc 

      implicit none

      REAL :: pddpo(kpie,kpje,kpke),ptiestu(kpie,kpje,kpke+1)
      REAL :: omask(kpie,kpje)
      INTEGER :: kpie,kpje,kpke,i,j,k,l

      REAL :: z_depth(33),dic_z(33),alk_z(33),pho_z(33),sil_z(33)
      REAL :: nit_z(33),oxy_z(33)
      REAL :: d,d1,d2

      DATA z_depth/   0.,  10.,  20.,  30.,  50.,  75., 100.&
     &            , 125., 150., 200., 250., 300., 400., 500.&
     &            , 600., 700., 800., 900.,1000.,1100.,1200.&
     &            ,1300.,1400.,1500.,1750.,2000.,2500.,3000.&
     &            ,3500.,4000.,4500.,5000.,5500./

      DATA dic_z/2033.3,2034.7,2038.6,2043.3,2055.4,2074.8,2094.6&
     &          ,2111.1,2124.9,2144.4,2157.4,2168.5,2186.8,2200.9&
     &          ,2213.5,2225.2,2236.5,2246.2,2254.6,2260.4,2265.7&
     &          ,2270.0,2272.9,2275.0,2277.6,2278.4,2287.5,2287.6&
     &          ,2277.2,2275.1,2273.6,2274.9,2283.4/

      DATA alk_z/2302.5,2303.6,2303.9,2305.5,2308.6,2311.8,2313.8&
     &          ,2314.6,2314.7,2313.5,2312.2,2311.1,2310.6,2312.2&
     &          ,2315.4,2320.0,2325.7,2331.8,2338.0,2343.5,2348.5&
     &          ,2353.5,2357.7,2361.2,2368.2,2373.5,2380.2,2383.9&
     &          ,2384.9,2384.6,2384.1,2386.0,2392.7/

      DATA pho_z/0.6746,0.6728,0.6904,0.7145,0.7785,0.8819,0.9752&
     &          ,1.0654,1.1456,1.2760,1.3885,1.4956,1.6831,1.8400&
     &          ,1.9689,2.0720,2.1509,2.2024,2.2418,2.2627,2.2711&
     &          ,2.2674,2.2578,2.2482,2.2152,2.1891,2.1589,2.1587&
     &          ,2.1630,2.1849,2.2235,2.2438,2.2820/

      DATA sil_z/ 11.0073, 10.6295, 10.5837, 10.8667, 11.7376, 13.6915&
     &          , 15.3556, 17.2705, 18.9997, 21.9522, 24.3912, 26.8708&
     &          , 31.5029, 36.4081, 42.0382, 47.6493, 53.4479, 59.0362&
     &          , 64.4495, 69.3628, 74.0481, 78.0860, 81.3177, 84.5503&
     &          , 91.0711, 95.2584,101.8426,106.9501,111.2050,115.5161&
     &          ,120.6887,122.6785,125.0825/

      DATA nit_z/ 6.8431, 6.8152, 6.9839, 7.2735, 8.2708, 9.9903&
     &          ,11.5826,13.2506,14.7229,16.8885,18.8348,20.5425&
     &          ,23.5901,25.9265,27.9332,29.4761,30.6634,31.3320&
     &          ,31.8923,32.1538,32.2893,32.2692,32.2065,32.0664&
     &          ,31.6932,31.2979,31.0386,31.1151,31.2683,31.6503&
     &          ,32.2647,32.6086,33.0370/

      DATA oxy_z/266.8797,265.6790,265.3678,263.9412,259.4916,248.6786&
     &          ,237.7945,227.6650,219.1991,206.4222,197.7969,191.4710&
     &          ,183.4747,178.9124,175.4987,171.0605,167.9570,165.5907&
     &          ,164.9865,165.6389,166.0252,167.8174,169.7003,171.1380&
     &          ,178.5088,182.9597,191.4299,197.5179,203.0385,206.9279&
     &          ,207.9537,207.0395,200.6155/

! ******************************************************************

!      do i=1,11
!      write(io_stdo_bgc,*) 'phosph z',z_phos(i),phos_z(i):w

!      enddo

      DO j=1,kpje
      DO i=1,kpie
        IF(omask(i,j).gt.0.5) THEN 

            ocetra(i,j,1,isco212)=dic_z( 1)*1.e-6
            ocetra(i,j,1,ialkali)=alk_z( 1)*1.e-6
            ocetra(i,j,1,iphosph)=pho_z( 1)*1.e-6
            ocetra(i,j,1,iano3  )=nit_z( 1)*1.e-6
            ocetra(i,j,1,isilica)=sil_z( 1)*1.e-6
            ocetra(i,j,1,ioxygen)=oxy_z( 1)*1.e-6

        DO k=2,kpke

          IF(ptiestu(i,j,k).ge.5500.) THEN

            ocetra(i,j,k,isco212)=dic_z(33)*1.e-6
            ocetra(i,j,k,ialkali)=alk_z(33)*1.e-6
            ocetra(i,j,k,iphosph)=pho_z(33)*1.e-6
            ocetra(i,j,k,iano3  )=nit_z(33)*1.e-6
            ocetra(i,j,k,isilica)=sil_z(33)*1.e-6
            ocetra(i,j,k,ioxygen)=oxy_z(33)*1.e-6

          ELSE 

            do l=1,32

              if(z_depth(l  ).le.ptiestu(i,j,k).and.                 &
     &           z_depth(l+1).ge.ptiestu(i,j,k)) then

                 d =z_depth(l+1)-z_depth(l)
                 d1=ptiestu(i,j,k)-z_depth(l)
                 d2=z_depth(l+1)-ptiestu(i,j,k)
 
                 ocetra(i,j,k,isco212)=((d2*dic_z(l)+d1*dic_z(l+1))/d)*1.e-6
                 ocetra(i,j,k,ialkali)=((d2*alk_z(l)+d1*alk_z(l+1))/d)*1.e-6
                 ocetra(i,j,k,iphosph)=((d2*pho_z(l)+d1*pho_z(l+1))/d)*1.e-6
                 ocetra(i,j,k,iano3  )=((d2*nit_z(l)+d1*nit_z(l+1))/d)*1.e-6
                 ocetra(i,j,k,isilica)=((d2*sil_z(l)+d1*sil_z(l+1))/d)*1.e-6
                 ocetra(i,j,k,ioxygen)=((d2*oxy_z(l)+d1*oxy_z(l+1))/d)*1.e-6
       
              endif
            enddo 

          ENDIF          

        ENDDO

        ENDIF
      ENDDO
      ENDDO

      RETURN
      END
